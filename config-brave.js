'use strict';

module.exports = {

  // 1. Add consent to the first pass of the page before measuring anything
  passes: [
  {
    passName: 'consentAccept',
    recordTrace: false,
    useThrottling: false,
    pauseAfterLoadMs: 10 * 1000, // wait for 5 seconds for any consent form to appear
    gatherers: [
      'control-brave-shieldsdown',
      'control-consent-accept',
      'control-brave-shieldsup',
    ],
  },
  {
    passName: 'defaultPass',
    recordTrace: true,
    useThrottling: true,
    pauseAfterLoadMs: 1*1000,
    networkQuietThresholdMs: 1000,
    cpuQuietThresholdMs: 1000,
    gatherers: [
      'css-usage',
      'viewport-dimensions',
      'runtime-exceptions',
      'console-messages',
      'anchor-elements',
      'image-elements',
      'link-elements',
      'meta-elements',
      'script-elements',
      // 'dobetterweb/doctype',
      'dobetterweb/domstats',
      'dobetterweb/optimized-images',
      'dobetterweb/response-compression',
      'dobetterweb/tags-blocking-first-paint',
      'adblock-analysis-gather',
    ],
  }],

  // 2. Add audits of interest from the full list of 'lighthouse:default'
  audits: [
    'is-on-https',
    'viewport',
    'metrics/first-contentful-paint',
    'metrics/first-meaningful-paint',
    'metrics/speed-index',
    'screenshot-thumbnails',
    'final-screenshot',
    'metrics/estimated-input-latency',
    'metrics/max-potential-fid',
    'errors-in-console',
    'time-to-first-byte',
    'metrics/first-cpu-idle',
    'metrics/interactive',
    'user-timings',
    'critical-request-chains',
    'redirects',
    'content-width',
    'image-aspect-ratio',
    'mainthread-work-breakdown',
    'bootup-time',
    'uses-rel-preload',
    'uses-rel-preconnect',
    'font-display',
    'diagnostics',
    'network-requests',
    'network-rtt',
    'network-server-latency',
    'main-thread-tasks',
    'metrics',
    'resource-summary',
    'third-party-summary',
    'byte-efficiency/uses-long-cache-ttl',
    'byte-efficiency/total-byte-weight',
    'byte-efficiency/offscreen-images',
    'byte-efficiency/render-blocking-resources',
    'byte-efficiency/unminified-css',
    'byte-efficiency/unminified-javascript',
    'byte-efficiency/unused-css-rules',
    'byte-efficiency/uses-webp-images',
    'byte-efficiency/uses-optimized-images',
    'byte-efficiency/uses-text-compression',
    'byte-efficiency/uses-responsive-images',
    'byte-efficiency/efficient-animated-content',
    'dobetterweb/dom-size',
    'dobetterweb/external-anchors-use-rel-noopener',
    'dobetterweb/no-document-write',
    'dobetterweb/no-vulnerable-libraries',
    'dobetterweb/js-libraries',
    'dobetterweb/uses-http2',
    'dobetterweb/uses-passive-event-listeners',
    'consent-audit',
    'adblock-audit',
    'adblock-summary',
  ],

  groups: {
    'metrics': {
      title: "Metrics",
    },
    'load-opportunities': {
      title: "Load opportunities",
      description: "Opportunities",
    },
    'budgets': {
      title: "Load budgets",
      description: "budgets",
    },
    'diagnostics': {
      title: "Diagnostics",
      description: "diagnostics",
    },
  },

  // 3. Createcategories for the audits
  categories: {
    'performance': {
      title: "Performance metrics",
      auditRefs: [
        {id: 'screenshot-thumbnails', weight: 0},
        {id: 'final-screenshot', weight: 0},
        {id: 'first-contentful-paint', weight: 3, group: 'metrics'},
        {id: 'first-meaningful-paint', weight: 1, group: 'metrics'},
        {id: 'speed-index', weight: 4, group: 'metrics'},
        {id: 'interactive', weight: 5, group: 'metrics'},
        {id: 'first-cpu-idle', weight: 2, group: 'metrics'},
        {id: 'max-potential-fid', weight: 0, group: 'metrics'},
        {id: 'estimated-input-latency', weight: 0}, // intentionally left out of metrics so it won't be displayed
        // {id: 'total-blocking-time', weight: 0}, // intentionally left out of metrics so it won't be displayed
        {id: 'render-blocking-resources', weight: 0, group: 'load-opportunities'},
        {id: 'uses-responsive-images', weight: 0, group: 'load-opportunities'},
        {id: 'offscreen-images', weight: 0, group: 'load-opportunities'},
        {id: 'unminified-css', weight: 0, group: 'load-opportunities'},
        {id: 'unminified-javascript', weight: 0, group: 'load-opportunities'},
        {id: 'unused-css-rules', weight: 0, group: 'load-opportunities'},
        {id: 'uses-optimized-images', weight: 0, group: 'load-opportunities'},
        {id: 'uses-webp-images', weight: 0, group: 'load-opportunities'},
        {id: 'uses-text-compression', weight: 0, group: 'load-opportunities'},
        {id: 'uses-rel-preconnect', weight: 0, group: 'load-opportunities'},
        {id: 'time-to-first-byte', weight: 0, group: 'load-opportunities'},
        {id: 'redirects', weight: 0, group: 'load-opportunities'},
        {id: 'uses-rel-preload', weight: 0, group: 'load-opportunities'},
        {id: 'efficient-animated-content', weight: 0, group: 'load-opportunities'},
        {id: 'total-byte-weight', weight: 0, group: 'diagnostics'},
        {id: 'uses-long-cache-ttl', weight: 0, group: 'diagnostics'},
        {id: 'dom-size', weight: 0, group: 'diagnostics'},
        {id: 'critical-request-chains', weight: 0, group: 'diagnostics'},
        {id: 'user-timings', weight: 0, group: 'diagnostics'},
        {id: 'bootup-time', weight: 0, group: 'diagnostics'},
        {id: 'mainthread-work-breakdown', weight: 0, group: 'diagnostics'},
        {id: 'font-display', weight: 0, group: 'diagnostics'},
        {id: 'resource-summary', weight: 0, group: 'diagnostics'},
        // Not visualised but included in JSON report
        {id: 'network-rtt', weight: 0},
        {id: 'network-server-latency', weight: 0},
        {id: 'diagnostics', weight: 0},
        {id: 'metrics', weight: 0},
      ],
    },
    'best-practices': {
      title: "Best Practices",
      auditRefs: [
        {id: 'uses-http2', weight: 1},
        {id: 'js-libraries', weight: 0},
        {id: 'errors-in-console', weight: 0.1},
      ],
    },
    'tracking': {
      title: 'User tracking metrics',
      description: 'Metrics related to user tracking',
      auditRefs: [
        // When we add more custom audits, `weight` controls how they're averaged together.
        {id: 'third-party-summary', weight: 0},
        {id: 'consent-audit', weight: 0},
        {id: 'adblock-summary', weight: 0},
        {id: 'adblock-audit', weight: 1},
        {id: 'network-requests', weight: 0},
      ],
    },
  },
};
